// üìÅ frontend/script.js
// üîê Login Form API Integration

document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('loginForm');

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const selectedRole = document.querySelector('.role.active')?.getAttribute('data-role');

    // ‚úÖ ‡¶´‡¶∞‡ßç‡¶Æ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
    if (!email || !password || !selectedRole) {
      showAlert('‡¶á‡¶Æ‡ßá‡¶á‡¶≤, ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßã‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
      return;
    }

    try {
      // üîó API ‡¶ï‡¶≤
      const response = await fetch('http://localhost:5000/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      const data = await response.json();

      if (!response.ok) {
        showAlert(data.message || '‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        return;
      }

      // ‚úÖ ‡¶∏‡¶´‡¶≤ ‡¶≤‡¶ó‡¶á‡¶®
      showAlert(`‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ${data.user.fullName}!`, 'success');

      // üîê JWT ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
      localStorage.setItem('token', data.token);
      localStorage.setItem('role', data.user.role);

      // üîÄ ‡¶∞‡ßã‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü
      setTimeout(() => {
        window.location.href = `/dashboard/${data.user.role}.html`;
      }, 1500);

    } catch (error) {
      showAlert('‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶è‡¶∞‡¶∞! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
    }
  });
});
